<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iso Farm - Hybrid Events</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #a6d785;
            font-family: sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            /* –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª */
            overflow-y: auto;
            overflow-x: hidden;
        }

        .game-container {
            position: relative;
            width: 100%;
            min-height: 120vh;
            display: flex;
            justify-content: center;
            padding-top: 80px;
        }

        .plot-container {
            position: relative;
            width: 540px;
        }

        .plot {
            position: absolute;
            width: 90px;
            height: 45px;
            /* –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –ª–æ–≤–∏—Ç—å—Å—è –Ω–∞ —ç—Ç–æ–º —Å–ª–æ–µ */
            pointer-events: all;
        }

        .plot::before {
            content: "";
            position: absolute;
            inset: 0;
            background: #4caf50;
            clip-path: polygon(50% 0, 100% 50%, 50% 100%, 0 50%);
            z-index: 1;
            transition: background 0.2s;
        }

        .plot:hover::before {
            filter: brightness(1.15);
        }

        .plot.harvested::before {
            background: #6b4f2c;
        }

        .plot img {
            position: absolute;
            left: 50%;
            bottom: 35%;
            width: 60px;
            transform: translateX(-50%);
            z-index: 2;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .plot.harvested img {
            opacity: 0;
            transform: translateX(-50%) translateY(20px) scale(0);
        }

        /* –¢—É–ª–±–∞—Ä */
        .toolbar {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 9999;
            pointer-events: none;
        }

        .tool {
            width: 70px;
            height: 70px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: 4px solid #fff;
            cursor: pointer;
            pointer-events: auto;
            touch-action: manipulation;
        }

        .tool.active {
            background: #ffeb3b;
            border-color: #fbc02d;
            transform: scale(1.1);
        }

        #status {
            position: fixed;
            top: 20px;
            width: 100%;
            text-align: center;
            font-weight: bold;
            color: #2e5a1c;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>

<body>

    <div id="status">–ò–ù–°–¢–†–£–ú–ï–ù–¢: –†–£–ö–ê</div>

    <div class="game-container">
        <div class="plot-container" id="field"></div>
    </div>

    <div class="toolbar">
        <div id="sickle-btn" class="tool">üåæ</div>
        <div id="reset-btn" class="tool">üîÑ</div>
    </div>

    <script>
        const field = document.getElementById('field');
        const sickleBtn = document.getElementById('sickle-btn');
        const resetBtn = document.getElementById('reset-btn');
        const statusText = document.getElementById('status');

        let isSickleMode = false;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∫–∏
        const cols = 4, rows = 8;
        const W = 90, H = 45;
        const ox = (cols - 1) * (W / 2);

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –ì–†–Ø–î–û–ö ---
        for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.style.left = ox - (x - y) * (W / 2) + 'px';
                plot.style.top = (x + y) * (H / 2) + 'px';

                const img = document.createElement('img');
                img.src = 'fsm/animals/dog/dog2.webp';
                img.onerror = () => img.src = 'https://cdn-icons-png.flaticon.com/128/188/188333.png';

                plot.appendChild(img);
                field.appendChild(plot);

                // --- –ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–´–ï –°–û–ë–´–¢–ò–Ø –î–õ–Ø –ü–õ–ê–¢–§–û–†–ú ---

                // –§—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≥—Ä—è–¥–∫–∏
                // const harvest = () => {
                //     if (isSickleMode && !plot.classList.contains('harvested')) {
                //         plot.classList.add('harvested');
                //         if (navigator.vibrate) navigator.vibrate(15);
                //     }
                // };

                // 1. –î–ª—è –º—ã—à–∏ (–ü–ö) - —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                // plot.onmouseenter = harvest;

                // 2. –î–ª—è —Ç–∞–ø–∞/–∫–ª–∏–∫–∞
                // plot.onpointerdown = (e) => {
                //     if (!e.target.closest('.tool')) harvest();
                // };
            }
        }

        // --- –õ–û–ì–ò–ö–ê –¢–£–õ–ë–ê–†–ê ---
        sickleBtn.onclick = () => {
            isSickleMode = !isSickleMode;
            sickleBtn.classList.toggle('active', isSickleMode);
            statusText.innerText = isSickleMode ? "–†–ï–ñ–ò–ú: –°–ï–†–ü (–í–ï–î–ò –ü–û –ü–û–õ–Æ)" : "–ò–ù–°–¢–†–£–ú–ï–ù–¢: –†–£–ö–ê";
        };

        resetBtn.onclick = () => {
            document.querySelectorAll('.plot').forEach(p => p.classList.remove('harvested'));
        };

        // --- –ü–û–î–î–ï–†–ñ–ö–ê –¢–ê–ß-–°–ö–†–û–õ–õ–ê (–ú–û–ë–ò–õ–¨–ù–´–ï) ---
        // –¢–∞–∫ –∫–∞–∫ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö mouseenter –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏, 
        // –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–Ω—É –æ–±—â—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Ç–∞—á–∞
        window.onmousemove = window.ontouchmove = (e) => {
            if (!isSickleMode) return;
            const touch = e.touches?.[0] || e;
            const target = document.elementFromPoint(touch.clientX, touch.clientY);
            const plot = target?.closest('.plot');

            // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –≥—Ä—è–¥–∫—É –ø–æ–¥ –ø–∞–ª—å—Ü–µ–º –≤–æ –≤—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è - –≤—ã–∑—ã–≤–∞–µ–º –µ—ë —Ñ—É–Ω–∫—Ü–∏—é
            if (plot && !plot.classList.contains('harvested')) {
                plot.classList.add('harvested');
                if (navigator.vibrate) navigator.vibrate(15);
            }
        };

    </script>
</body>

</html>